<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Mosley Auto</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <style>
        .admin-header {
            background: linear-gradient(135deg, #ff0000, #cc0000);
            color: white;
            padding: 20px;
            text-align: center;
            border-bottom: 5px solid #0066cc;
        }
        
        .admin-nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .admin-nav-btn {
            background: #0066cc;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .admin-nav-btn:hover, .admin-nav-btn.active {
            background: #ffff00;
            color: #000;
        }
        
        .admin-section {
            display: none;
            padding: 30px;
        }
        
        .admin-section.active {
            display: block;
        }
        
        .section-title {
            color: #ff0000;
            font-size: 2rem;
            margin-bottom: 20px;
            text-shadow: 1px 1px 0px #000;
        }
        
        .form-container {
            background: rgba(0, 102, 204, 0.1);
            padding: 25px;
            border-radius: 15px;
            border: 3px solid #0066cc;
            margin-bottom: 30px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-label {
            color: #0066cc;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .form-input, .form-textarea {
            padding: 10px;
            border: 2px solid #0066cc;
            border-radius: 5px;
            font-family: inherit;
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #ff0000;
        }
        
        .submit-btn {
            background: #ff0000;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .submit-btn:hover {
            background: #cc0000;
            transform: scale(1.05);
        }
        
        .items-list {
            background: white;
            border: 3px solid #ff0000;
            border-radius: 15px;
            padding: 20px;
        }
        
        .item-card {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #0066cc;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .item-info {
            flex: 1;
        }
        
        .item-title {
            color: #ff0000;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .item-details {
            color: #0066cc;
            font-size: 0.9rem;
        }
        
        .delete-btn {
            background: #ff4444;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .delete-btn:hover {
            background: #cc0000;
            transform: scale(1.05);
        }
        
        .logout-btn {
            background: #666;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .logout-btn:hover {
            background: #333;
        }
        
        .message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
            text-align: center;
        }
        
        .success {
            background: rgba(0, 255, 0, 0.1);
            color: #008800;
            border: 2px solid #008800;
        }
        
        .error {
            background: rgba(255, 0, 0, 0.1);
            color: #ff0000;
            border: 2px solid #ff0000;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="admin-header">
            <h1 class="logo">MOSLEY AUTO ADMIN</h1>
            <p class="tagline">â˜… MANAGE YOUR DEALERSHIP! â˜…</p>
            <nav class="admin-nav">
                <button class="admin-nav-btn active" onclick="showSection('vehicles')">MANAGE VEHICLES</button>
                <button class="admin-nav-btn" onclick="showSection('team')">MANAGE TEAM</button>
                <button class="logout-btn" onclick="logout()">LOGOUT</button>
            </nav>
        </header>

        <main>
            <!-- Vehicles Section -->
            <section id="vehicles-section" class="admin-section active">
                <h2 class="section-title">ðŸš— Manage Vehicles</h2>
                
                <div id="vehicle-message"></div>
                
                <div class="form-container">
                    <h3 style="color: #0066cc; margin-bottom: 15px;">Add New Vehicle</h3>
                    <form id="vehicle-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Make:</label>
                                <input type="text" id="vehicle-make" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Model:</label>
                                <input type="text" id="vehicle-model" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Year:</label>
                                <input type="number" id="vehicle-year" class="form-input" min="1900" max="2030" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Price ($):</label>
                                <input type="number" id="vehicle-price" class="form-input" min="0" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Mileage:</label>
                                <input type="number" id="vehicle-mileage" class="form-input" min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Color:</label>
                                <input type="text" id="vehicle-color" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Transmission:</label>
                                <select id="vehicle-transmission" class="form-input">
                                    <option value="Automatic">Automatic</option>
                                    <option value="Manual">Manual</option>
                                    <option value="CVT">CVT</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Image URL:</label>
                                <input type="url" id="vehicle-image" class="form-input" placeholder="https://example.com/image.jpg">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description:</label>
                            <textarea id="vehicle-description" class="form-textarea" placeholder="Describe this amazing car!"></textarea>
                        </div>
                        <button type="submit" class="submit-btn">ADD VEHICLE</button>
                    </form>
                </div>
                
                <div class="items-list">
                    <h3 style="color: #ff0000; margin-bottom: 15px;">Current Vehicles</h3>
                    <div id="vehicles-list">Loading vehicles...</div>
                </div>
            </section>

            <!-- Team Section -->
            <section id="team-section" class="admin-section">
                <h2 class="section-title">ðŸ‘¥ Manage Team</h2>
                
                <div id="team-message"></div>
                
                <div class="form-container">
                    <h3 style="color: #0066cc; margin-bottom: 15px;">Add New Team Member</h3>
                    <form id="team-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Name:</label>
                                <input type="text" id="member-name" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Role:</label>
                                <input type="text" id="member-role" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Photo URL:</label>
                                <input type="url" id="member-photo" class="form-input" placeholder="https://example.com/photo.jpg">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Bio:</label>
                            <textarea id="member-bio" class="form-textarea" placeholder="Tell us about this team member!"></textarea>
                        </div>
                        <button type="submit" class="submit-btn">ADD TEAM MEMBER</button>
                    </form>
                </div>
                
                <div class="items-list">
                    <h3 style="color: #ff0000; margin-bottom: 15px;">Current Team</h3>
                    <div id="team-list">Loading team...</div>
                </div>
            </section>
        </main>
    </div>

    <script>
        const adminKey = sessionStorage.getItem('adminKey');
        
        // Check if logged in
        if (!adminKey) {
            window.location.href = '/admin';
        }
        
        // Show/hide sections
        function showSection(section) {
            document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.admin-nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(section + '-section').classList.add('active');
            event.target.classList.add('active');
            
            if (section === 'vehicles') {
                loadVehicles();
            } else if (section === 'team') {
                loadTeam();
            }
        }
        
        // Logout
        function logout() {
            sessionStorage.removeItem('adminKey');
            window.location.href = '/admin';
        }
        
        // Show message
        function showMessage(elementId, message, type) {
            const messageEl = document.getElementById(elementId);
            messageEl.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => {
                messageEl.innerHTML = '';
            }, 5000);
        }
        
        // Vehicle Management
        document.getElementById('vehicle-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const vehicle = {
                make: document.getElementById('vehicle-make').value,
                model: document.getElementById('vehicle-model').value,
                year: document.getElementById('vehicle-year').value,
                price: document.getElementById('vehicle-price').value,
                mileage: document.getElementById('vehicle-mileage').value,
                color: document.getElementById('vehicle-color').value,
                transmission: document.getElementById('vehicle-transmission').value,
                description: document.getElementById('vehicle-description').value,
                image: document.getElementById('vehicle-image').value
            };
            
            try {
                const response = await fetch('/api/stock', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ adminKey, vehicle })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('vehicle-message', 'Vehicle added successfully!', 'success');
                    document.getElementById('vehicle-form').reset();
                    loadVehicles();
                } else {
                    showMessage('vehicle-message', data.message || 'Failed to add vehicle', 'error');
                }
            } catch (error) {
                showMessage('vehicle-message', 'Error adding vehicle', 'error');
            }
        });
        
        async function loadVehicles() {
            try {
                const response = await fetch('/api/stock');
                const data = await response.json();
                
                const listEl = document.getElementById('vehicles-list');
                
                if (data.success && data.vehicles.length > 0) {
                    listEl.innerHTML = data.vehicles.map(vehicle => `
                        <div class="item-card">
                            <div class="item-info">
                                <div class="item-title">${vehicle.year} ${vehicle.make} ${vehicle.model}</div>
                                <div class="item-details">$${vehicle.price.toLocaleString()} â€¢ ${vehicle.mileage.toLocaleString()} miles â€¢ ${vehicle.color}</div>
                            </div>
                            <button class="delete-btn" onclick="deleteVehicle(${vehicle.id})">DELETE</button>
                        </div>
                    `).join('');
                } else {
                    listEl.innerHTML = '<p style="text-align: center; color: #666;">No vehicles found</p>';
                }
            } catch (error) {
                document.getElementById('vehicles-list').innerHTML = '<p style="text-align: center; color: #ff0000;">Error loading vehicles</p>';
            }
        }
        
        async function deleteVehicle(vehicleId) {
            if (!confirm('Are you sure you want to delete this vehicle?')) return;
            
            try {
                const response = await fetch('/api/stock', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ adminKey, vehicleId })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('vehicle-message', 'Vehicle deleted successfully!', 'success');
                    loadVehicles();
                } else {
                    showMessage('vehicle-message', data.message || 'Failed to delete vehicle', 'error');
                }
            } catch (error) {
                showMessage('vehicle-message', 'Error deleting vehicle', 'error');
            }
        }
        
        // Team Management
        document.getElementById('team-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const member = {
                name: document.getElementById('member-name').value,
                role: document.getElementById('member-role').value,
                bio: document.getElementById('member-bio').value,
                photo: document.getElementById('member-photo').value
            };
            
            try {
                const response = await fetch('/api/team', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ adminKey, member })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('team-message', 'Team member added successfully!', 'success');
                    document.getElementById('team-form').reset();
                    loadTeam();
                } else {
                    showMessage('team-message', data.message || 'Failed to add team member', 'error');
                }
            } catch (error) {
                showMessage('team-message', 'Error adding team member', 'error');
            }
        });
        
        async function loadTeam() {
            try {
                const response = await fetch('/api/team');
                const data = await response.json();
                
                const listEl = document.getElementById('team-list');
                
                if (data.success && data.team.length > 0) {
                    listEl.innerHTML = data.team.map(member => `
                        <div class="item-card">
                            <div class="item-info">
                                <div class="item-title">${member.name}</div>
                                <div class="item-details">${member.role}</div>
                            </div>
                            <button class="delete-btn" onclick="deleteMember(${member.id})">DELETE</button>
                        </div>
                    `).join('');
                } else {
                    listEl.innerHTML = '<p style="text-align: center; color: #666;">No team members found</p>';
                }
            } catch (error) {
                document.getElementById('team-list').innerHTML = '<p style="text-align: center; color: #ff0000;">Error loading team</p>';
            }
        }
        
        async function deleteMember(memberId) {
            if (!confirm('Are you sure you want to delete this team member?')) return;
            
            try {
                const response = await fetch('/api/team', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ adminKey, memberId })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('team-message', 'Team member deleted successfully!', 'success');
                    loadTeam();
                } else {
                    showMessage('team-message', data.message || 'Failed to delete team member', 'error');
                }
            } catch (error) {
                showMessage('team-message', 'Error deleting team member', 'error');
            }
        }
        
        // Load initial data
        loadVehicles();
    </script>
</body>
</html>